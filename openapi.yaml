openapi: 3.0.3
info:
  title: Authentication API
  description: API for user registration, login, and session management.
  version: 1.0.0
servers:
  - url: /auth
    description: Auth Route Root

errors: 
  '200': 
    description: Success
  '400': 
    description: Auth Failed
  '401': 
    description: Unauthorized
  '402': 
    description: Token Expired
  '403': 
    description: Missing Data
  '404': 
    description: User Not Found
  '405': 
    description: Invalid Password
  '406': 
    description: User Already Exisit
  '420': 
    description: No Active Session
  '421': 
    description: No Trusted Device
  '500': 
    description: Error

paths:
  /sign-up:
    post:
      summary: User registration
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email: { type: string, format: email }
                password: { type: string }
                device_name: { type: string }
                user_agent: { type: string }
                os: { type: string }
                ip: { type: string }
                type: { type: string }
      responses:
        '200':
          description: User created successfully
        '403':
          description: Missing email or password
        '406':
          description: User already exists
        '200_success':
          description: Success response with tokens
          content:
            application/json:
              example:
                success: true
                message: "User Created Successfully!"
                data: { refresh_token: "...", access_token: "...", user: [...] }

  /sign-in:
    post:
      summary: User login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email: { type: string }
                password: { type: string }
      responses:
        '200':
          description: Login successful
        '404':
          description: User not found
        '405':
          description: Invalid password
        '420':
          description: Device not trusted
        '421':
          description: No active session

  /send-otp:
    post:
      summary: Send OTP for verification
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, user_id]
              properties:
                email: { type: string }
                user_id: { type: string }
      responses:
        '200':
          description: OTP sent successfully
        '403':
          description: Missing data
        '500':
          description: Failed to send OTP

  /verify-otp:
    post:
      summary: Verify the sent OTP
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, user_id, otp]
              properties:
                email: { type: string }
                user_id: { type: string }
                otp: { type: string }
      responses:
        '200':
          description: OTP verified successfully
        '403':
          description: Missing data
        '500':
          description: OTP expired or verification failed

  /session-device:
    post:
      summary: Create or update session for a specific device
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, device_name, os, user_id, ip]
              properties:
                email: { type: string }
                device_name: { type: string }
                user_agent: { type: string }
                os: { type: string }
                user_id: { type: string }
                ip: { type: string }
                type: { type: string }
      responses:
        '200':
          description: Device session set/updated successfully
        '403':
          description: Missing required data

  /check:
    post:
      summary: Validate a refresh token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [refresh_token]
              properties:
                refresh_token: { type: string }
      responses:
        '200':
          description: Refresh token is valid
        '500':
          description: Refresh token is invalid or expired